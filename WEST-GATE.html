<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thank you!</title>

<link href="https://fonts.googleapis.com/css2?family=Epunda+Slab&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

<style>
 body{margin:0; font-family:'Epunda Slab','Zen Maru Gothic',sans-serif; display:grid; place-items:center; min-height:100vh;
 background:linear-gradient(135deg,#f7f7ff,#fff0f6);}
 .card{background:#fff; padding:28px 24px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
 text-align:center; width:min(92vw,520px)}
 h1{margin:.2em 0 0; font-size:32px}
 p{margin:.4em 0; line-height:1.6}
 .tag{display:inline-block; padding:.2em .7em; border-radius:999px; background:#eef; color:#334; font-weight:600}
 .small{opacity:.7; font-size:12px}
 button{margin-top:12px; padding:10px 14px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer}
 canvas{position:fixed; inset:0; pointer-events:none}
 .notice{margin-top:10px; font-size:12px; color:#777; line-height:1.4;}
</style>

<div class="card">
 <div class="tag" id="spot">EXPO 2025 WEST GATE</div>
 <h1>Thank you <span id="name">西ゲート</span>！</h1>
 <p id="msg">おつかれさまでした！</p>
 <button id="again">紙吹雪をもう一度</button>
 <p class="small" id="stamp"></p>
 <p class="notice">
 ※ランダムで紙吹雪が変化！<br>
 ※2025/10/15更新
 </p>
</div>

<canvas id="fx"></canvas>

<script>
/* --- テキスト埋め込み --- */
const q = new URLSearchParams(location.search);
document.getElementById("name").textContent = q.get("name") || "西ゲート";
document.getElementById("spot").textContent = q.get("spot") || "EXPO 2025 WEST GATE";
document.getElementById("msg").textContent = q.get("msg") || "おつかれさまでした！";

/* --- Canvas 基本 --- */
const cv = document.getElementById("fx");
const ctx = cv.getContext("2d");
let W,H,P=[];
function resize(){ W=cv.width=innerWidth; H=cv.height=innerHeight; }
addEventListener("resize", resize); resize();

/* ================= エミッタ（ここが肝） ================= */
function burst(type = "normal", n = 90) {
// 古い粒を間引き（重くならないように）
if (P.length > 600) P.splice(0, P.length - 600);

if (type === "normal" || type === "heart") {
for (let i=0;i<n;i++){
const isHeart = (type === "heart");
const clr = isHeart
? (Math.random()<0.5 ? "#e6002d" : "#0066cc") // 赤 or 青（ハート）
: `hsl(${Math.random()*360},85%,60%)`; // 通常はカラフル
const shape = isHeart ? "heart" : "square";
const sz = isHeart ? (10 + Math.random()*10) : (4 + Math.random()*6); // ←ハートだけ大きめ
const vr = isHeart ? ((Math.random()-0.5)*0.05) : ((Math.random()-0.5)*0.2); // ←ハートは回転ほぼ無し

P.push({
kind:"confetti",
x: W/2, y: H/3 + Math.random()*40,
vx:(Math.random()-0.5)*6,
vy:-(2+Math.random()*3),
sz, rot:Math.random()*Math.PI*2, vr,
clr, shape
});
}
} else if (type === "fireworks") {
fireworksDokkan(5); // ドカン×5発
}
}

/* =============== 花火（ドカン×5） =============== */
function fireworksDokkan(count=5){
const colors = ["#0066cc","#e6002d","#d4af37"]; // 青・赤・金
for(let i=0;i<count;i++){
const x = W*0.2 + Math.random()*W*0.6; // 中央寄り
const y = H*0.28 + Math.random()*H*0.18; // 上の方
const delay = i*6; // 少し時間差
const c = colors[Math.floor(Math.random()*colors.length)];
P.push({ kind:"burst", x, y, color:c, delay, spawned:false });
}
}

function spawnSparks(x,y,color){
const N = 60; // 粒数（重ければ50前後に）
for(let i=0;i<N;i++){
const ang = Math.random()*Math.PI*2;
const spd = 2 + Math.random()*5;
P.push({
kind:"spark",
x, y,
vx: Math.cos(ang)*spd,
vy: Math.sin(ang)*spd,
life: 52, maxlife: 52,
clr: color,
sz: 2 + Math.random()*2
});
}
}

/* ================= 形の描画 ================= */
function drawHeart(p){
const s=p.sz;
ctx.beginPath();
ctx.moveTo(0,-s*0.5);
ctx.bezierCurveTo( s*0.5,-s, s,-s*0.1, 0, s*0.6);
ctx.bezierCurveTo(-s,-s*0.1,-s*0.5,-s, 0,-s*0.5);
ctx.closePath(); ctx.fill();
}
function drawShape(p){
if(p.shape==='heart') drawHeart(p);
else if(p.shape==='circle'){ ctx.beginPath(); ctx.arc(0,0,p.sz/2,0,Math.PI*2); ctx.fill(); }
else ctx.fillRect(-p.sz/2,-p.sz/2,p.sz,p.sz);
}

/* ================= ループ ================= */
function step(){
ctx.clearRect(0,0,W,H);

P.forEach(p=>{
if(p.kind==="confetti"){
p.vy += 0.07; p.x += p.vx; p.y += p.vy; p.rot += p.vr;
ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
ctx.fillStyle = p.clr; drawShape(p); ctx.restore();
}
else if(p.kind==="burst"){
p.delay--;
if(!p.spawned && p.delay<=0){
p.spawned = true;
// 爆発フラッシュ
ctx.save();
ctx.globalCompositeOperation = "lighter";
const grd = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,60);
grd.addColorStop(0, "rgba(255,255,255,0.9)");
grd.addColorStop(1, "rgba(255,255,255,0)");
ctx.fillStyle = grd;
ctx.beginPath(); ctx.arc(p.x,p.y,60,0,Math.PI*2); ctx.fill();
ctx.restore();
spawnSparks(p.x,p.y,p.color);
}
}
else if(p.kind==="spark"){
p.vx *= 0.99; p.vy = p.vy*0.99 + 0.05; // ほんの少し重力
p.x += p.vx; p.y += p.vy;
p.life--;
const a = Math.max(0, p.life/p.maxlife);
ctx.save();
ctx.globalCompositeOperation = "lighter";
ctx.globalAlpha = a*0.9;
// 外側グロー
ctx.beginPath(); ctx.arc(p.x,p.y,p.sz*2.5,0,Math.PI*2);
ctx.fillStyle = p.clr + "55"; ctx.fill();
// コア
ctx.beginPath(); ctx.arc(p.x,p.y,p.sz,0,Math.PI*2);
ctx.fillStyle = p.clr; ctx.fill();
ctx.restore();
}
});

// 後始末
P = P.filter(p=>{
if(p.kind==="confetti") return p.y < H+40;
if(p.kind==="burst") return !p.spawned;
if(p.kind==="spark") return p.life>0;
return true;
});

requestAnimationFrame(step);
}
step();

/* ================= ガチャ抽選 ================= */
// 5%：花火（ドカン×5） / 20%：赤青ハート / それ以外：通常
document.getElementById("again").onclick = ()=>{
const roll = Math.random();
if(roll < 0.05){
burst("fireworks");
} else if(roll < 0.25){
burst("heart", 90);
} else {
burst("normal", 90);
}
};

// 初期は通常紙吹雪
burst("normal", 90);
</script>
