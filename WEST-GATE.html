<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thank you!</title>

<link href="https://fonts.googleapis.com/css2?family=Epunda+Slab&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

<style>
 body{margin:0; font-family:'Epunda Slab','Zen Maru Gothic',sans-serif; display:grid; place-items:center; min-height:100vh;
 background:linear-gradient(135deg,#f7f7ff,#fff0f6);}
 .card{background:#fff; padding:28px 24px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
 text-align:center; width:min(92vw,520px)}
 h1{margin:.2em 0 0; font-size:32px}
 p{margin:.4em 0; line-height:1.6}
 .tag{display:inline-block; padding:.2em .7em; border-radius:999px; background:#eef; color:#334; font-weight:600}
 .small{opacity:.7; font-size:12px}
 button{margin-top:12px; padding:10px 14px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer}
 canvas{position:fixed; inset:0; pointer-events:none}
 .notice{margin-top:10px; font-size:12px; color:#777; line-height:1.4;}
</style>

<div class="card">
 <div class="tag" id="spot">EXPO 2025 WEST GATE</div>
 <h1>Thank you <span id="name">西ゲート</span>！</h1>
 <p id="msg">おつかれさまでした！</p>
 <button id="again">紙吹雪をもう一度</button>
 <p class="small" id="stamp"></p>
 <p class="notice">
 ※ランダムで紙吹雪が変化！<br>
 ※2025/10/15更新
 </p>
</div>

<canvas id="fx"></canvas>

<script>
/* --- テキスト埋め込み --- */
const q = new URLSearchParams(location.search);
document.getElementById("name").textContent = q.get("name") || "西ゲート";
document.getElementById("spot").textContent = q.get("spot") || "EXPO 2025 WEST GATE";
document.getElementById("msg").textContent = q.get("msg") || "おつかれさまでした！";

/* --- Canvas 基本 --- */
const cv = document.getElementById("fx");
const ctx = cv.getContext("2d");
let W,H,P=[];
function resize(){ W=cv.width=innerWidth; H=cv.height=innerHeight; }
addEventListener("resize", resize); resize();

/* === パラメータ（調整しやすくまとめ） === */
const NORMAL_COUNT = 120; // はじめと同じくらい
const HEART_COUNT = 100; // ハート粒の数
const SPARKLE_COUNT = 80; // キラキラ粒の数（軽量）
const MAX_PARTICLES = 600; // これ以上は古いのを捨てて軽量化

/* === エミッタ === */
function burst(type="normal", n=NORMAL_COUNT){
// 古い粒を間引き（スマホで重くならないように）
if (P.length > MAX_PARTICLES) P.splice(0, P.length - MAX_PARTICLES);

if (type === "normal"){
for(let i=0;i<n;i++){
P.push(makeConfetti(false));
}
}
else if (type === "heartSparkle"){
// ハート
for(let i=0;i<HEART_COUNT;i++){
P.push(makeConfetti(true)); // ハート版
}
// キラキラ（白＆金の小粒の四角を同時に降らせる）
for(let i=0;i<SPARKLE_COUNT;i++){
P.push(makeSparkle());
}
}
}

/* === 粒のファクトリ === */
function makeConfetti(isHeart){
const heart = !!isHeart;
const clr = heart ? (Math.random()<0.5 ? "#e6002d" : "#0066cc")
: `hsl(${Math.random()*360},85%,60%)`;
const sz = heart ? (10 + Math.random()*10) : (4 + Math.random()*6);
const vr = heart ? ((Math.random()-0.5)*0.04) : ((Math.random()-0.5)*0.2); // ハートは回転ほぼ無し
return {
kind:"confetti",
heart,
x: W/2, y: H/3 + Math.random()*40,
vx:(Math.random()-0.5)*6,
vy:-(2+Math.random()*3),
sz, rot:Math.random()*Math.PI*2, vr,
clr
};
}

function makeSparkle(){
// 軽量な“キラキラ”粒（白 or 金の小さな四角）
const colors = ["#fff8dc","#ffd700"]; // クリーム寄りの白／金
const clr = colors[Math.floor(Math.random()*colors.length)];
return {
kind:"sparkle",
x: W*0.2 + Math.random()*W*0.6, // だいたい中央域から
y: H*0.25 + Math.random()*H*0.2,
vx:(Math.random()-0.5)*1.2,
vy: 0.6 + Math.random()*0.6, // ゆっくり落ちる
sz: 1.5 + Math.random()*2.0,
clr,
// ちらつき用の簡易フェーズ（加算合成なしでキラ感を演出）
phase: Math.random()*Math.PI*2,
life: 70
};
}

/* === 形の描画 === */
function drawHeart(p){
const s=p.sz;
ctx.beginPath();
ctx.moveTo(0,-s*0.5);
ctx.bezierCurveTo( s*0.5,-s, s,-s*0.1, 0, s*0.6);
ctx.bezierCurveTo(-s,-s*0.1,-s*0.5,-s, 0,-s*0.5);
ctx.closePath(); ctx.fill();
}
function drawConfetti(p){
if(p.heart){ drawHeart(p); }
else{ ctx.fillRect(-p.sz/2,-p.sz/2,p.sz,p.sz); }
}

/* === ループ === */
function step(){
ctx.clearRect(0,0,W,H);

P.forEach(p=>{
if(p.kind==="confetti"){
p.vy += 0.07; p.x += p.vx; p.y += p.vy; p.rot += p.vr;
ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
ctx.fillStyle = p.clr; drawConfetti(p); ctx.restore();
}
else if(p.kind==="sparkle"){
// ふわっと落下＋チラチラ
p.x += p.vx; p.y += p.vy; p.life--;
p.phase += 0.25; // 点滅速度
const a = 0.4 + 0.4*Math.abs(Math.sin(p.phase)); // 0.4〜0.8でゆるく点滅
ctx.save();
ctx.globalAlpha = a; // 合成は普通のまま（軽い）
ctx.fillStyle = p.clr;
ctx.fillRect(p.x - p.sz/2, p.y - p.sz/2, p.sz, p.sz);
ctx.restore();
}
});

// 後始末
P = P.filter(p=>{
if(p.kind==="confetti") return p.y < H+40;
if(p.kind==="sparkle") return p.life > 0 && p.y < H+40;
return true;
});

requestAnimationFrame(step);
}
step();

/* === ガチャ抽選 === */
// 10%：ハート＋キラキラ同時、それ以外：ノーマル
document.getElementById("again").onclick = ()=>{
const roll = Math.random();
if(roll < 0.10){
burst("heartSparkle");
} else {
burst("normal");
}
};

// 初回はノーマル紙吹雪（最初と同程度）
burst("normal", NORMAL_COUNT);
</script>
