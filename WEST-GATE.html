<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thank you!</title>

<link href="https://fonts.googleapis.com/css2?family=Epunda+Slab&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

<style>
 body{margin:0; font-family:'Epunda Slab','Zen Maru Gothic',sans-serif; display:grid; place-items:center; min-height:100vh;
 background:linear-gradient(135deg,#f7f7ff,#fff0f6);}
 .card{background:#fff; padding:28px 24px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
 text-align:center; width:min(92vw,520px)}
 h1{margin:.2em 0 0; font-size:32px}
 p{margin:.4em 0; line-height:1.6}
 .tag{display:inline-block; padding:.2em .7em; border-radius:999px; background:#eef; color:#334; font-weight:600}
 .small{opacity:.7; font-size:12px}
 button{margin-top:12px; padding:10px 14px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer}
 canvas{position:fixed; inset:0; pointer-events:none}
 .notice{margin-top:10px; font-size:12px; color:#777; line-height:1.4;}
</style>

<div class="card">
 <div class="tag" id="spot">EXPO 2025 WEST GATE</div>
 <h1>Thank you <span id="name">西ゲート</span>！</h1>
 <p id="msg">おつかれさまでした！</p>
 <button id="again">紙吹雪をもう一度</button>
 <p class="small" id="stamp"></p>
 <p class="notice">
 ※ランダムで紙吹雪が変化！<br>
 ※2025/10/15更新
 </p>
</div>

<canvas id="fx"></canvas>

<script>
const q = new URLSearchParams(location.search);
document.getElementById("name").textContent = q.get("name") || "西ゲート";
document.getElementById("spot").textContent = q.get("spot") || "EXPO 2025 WEST GATE";
document.getElementById("msg").textContent = q.get("msg") || "おつかれさまでした！";

const cv = document.getElementById("fx");
const ctx = cv.getContext("2d");
let W,H,P=[];
function resize(){W=cv.width=innerWidth;H=cv.height=innerHeight;}
addEventListener("resize",resize);resize();

/* === エミッタ === */
function burst(type="normal",n=50){ // 全体を半分に
 if(P.length>400)P.splice(0,P.length-400);

 if(type==="normal"||type==="heart"){
 for(let i=0;i<n;i++){
 const heart=(type==="heart");
 const clr=heart?(Math.random()<0.5?"#e6002d":"#0066cc"):`hsl(${Math.random()*360},85%,60%)`;
 const shape=heart?"heart":"square";
 const sz=heart?(10+Math.random()*8):(4+Math.random()*4);
 const vr=heart?((Math.random()-0.5)*0.03):((Math.random()-0.5)*0.15);
 P.push({
 kind:"confetti",
 x:W/2,y:H/3+Math.random()*40,
 vx:(Math.random()-0.5)*5,
 vy:-(2+Math.random()*2),
 sz,rot:Math.random()*Math.PI*2,vr,clr,shape
 });
 }
 }else if(type==="fireworks"){
 fireworksDokkan(4); // 花火も少なめに
 }
}

/* === 花火 === */
function fireworksDokkan(count=4){
 const colors=["#0066cc","#e6002d","#d4af37"];
 for(let i=0;i<count;i++){
 const x=W*0.25+Math.random()*W*0.5;
 const y=H*0.3+Math.random()*H*0.2;
 const delay=i*8;
 const c=colors[Math.floor(Math.random()*colors.length)];
 P.push({kind:"burst",x,y,color:c,delay,spawned:false});
 }
}

function spawnSparks(x,y,color){
 const N=40; // 粒数さらに減
 for(let i=0;i<N;i++){
 const ang=Math.random()*Math.PI*2;
 const spd=1.5+Math.random()*4;
 P.push({
 kind:"spark",x,y,
 vx:Math.cos(ang)*spd,vy:Math.sin(ang)*spd,
 life:45,maxlife:45,clr:color,sz:1.5+Math.random()*2
 });
 }
}

/* === 描画 === */
function drawHeart(p){
 const s=p.sz;
 ctx.beginPath();
 ctx.moveTo(0,-s*0.5);
 ctx.bezierCurveTo(s*0.5,-s,s,-s*0.1,0,s*0.6);
 ctx.bezierCurveTo(-s,-s*0.1,-s*0.5,-s,0,-s*0.5);
 ctx.closePath();ctx.fill();
}
function drawShape(p){
 if(p.shape==='heart')drawHeart(p);
 else ctx.fillRect(-p.sz/2,-p.sz/2,p.sz,p.sz);
}

/* === メインループ === */
function step(){
 ctx.clearRect(0,0,W,H);
 P.forEach(p=>{
 if(p.kind==="confetti"){
 p.vy+=0.06;p.x+=p.vx;p.y+=p.vy;p.rot+=p.vr;
 ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);
 ctx.fillStyle=p.clr;drawShape(p);ctx.restore();
 }
 else if(p.kind==="burst"){
 p.delay--;
 if(!p.spawned&&p.delay<=0){
 p.spawned=true;
 ctx.save();
 ctx.globalCompositeOperation="lighter";
 const g=ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,40);
 g.addColorStop(0,"rgba(255,255,255,0.9)");
 g.addColorStop(1,"rgba(255,255,255,0)");
 ctx.fillStyle=g;
 ctx.beginPath();ctx.arc(p.x,p.y,40,0,Math.PI*2);ctx.fill();
 ctx.restore();
 spawnSparks(p.x,p.y,p.color);
 }
 }
 else if(p.kind==="spark"){
 p.vx*=0.985;p.vy=p.vy*0.985+0.04;p.x+=p.vx;p.y+=p.vy;p.life--;
 const a=Math.max(0,p.life/p.maxlife);
 ctx.save();ctx.globalCompositeOperation="lighter";ctx.globalAlpha=a*0.9;
 ctx.beginPath();ctx.arc(p.x,p.y,p.sz*2,0,Math.PI*2);
 ctx.fillStyle=p.clr+"55";ctx.fill();
 ctx.beginPath();ctx.arc(p.x,p.y,p.sz,0,Math.PI*2);
 ctx.fillStyle=p.clr;ctx.fill();ctx.restore();
 }
 });
 P=P.filter(p=>{
 if(p.kind==="confetti")return p.y<H+40;
 if(p.kind==="burst")return !p.spawned;
 if(p.kind==="spark")return p.life>0;
 return true;
 });
 requestAnimationFrame(step);
}
step();

/* === ガチャ抽選 === */
document.getElementById("again").onclick=()=>{
 const roll=Math.random();
 if(roll<0.05)burst("fireworks");
 else if(roll<0.25)burst("heart",60);
 else burst("normal",60);
};
burst("normal",60);
</script>
