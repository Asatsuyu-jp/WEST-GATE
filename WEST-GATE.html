<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Thank you!</title>

<link href="https://fonts.googleapis.com/css2?family=Epunda+Slab&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

<style>
 body{margin:0; font-family:'Epunda Slab','Zen Maru Gothic',sans-serif; display:grid; place-items:center; min-height:100vh;
 background:linear-gradient(135deg,#f7f7ff,#fff0f6);}
 .card{background:#fff; padding:28px 24px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08);
 text-align:center; width:min(92vw,520px)}
 h1{margin:.2em 0 0; font-size:32px}
 p{margin:.4em 0; line-height:1.6}
 .tag{display:inline-block; padding:.2em .7em; border-radius:999px; background:#eef; color:#334; font-weight:600}
 .small{opacity:.7; font-size:12px}
 button{margin-top:12px; padding:10px 14px; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer}
 canvas{position:fixed; inset:0; pointer-events:none}
 .notice{margin-top:10px; font-size:12px; color:#777; line-height:1.4;}
</style>

<div class="card">
 <div class="tag" id="spot">EXPO 2025 WEST GATE</div>
 <h1>Thank you <span id="name">西ゲート</span>！</h1>
 <p id="msg">おつかれさまでした！</p>
 <button id="again">紙吹雪をもう一度</button>
 <p class="small" id="stamp"></p>
 <p class="notice">
 ※ランダムで紙吹雪が変化！<br>
 ※2025/10/15更新
 </p>
</div>

<canvas id="fx"></canvas>

<script>
/* === テキスト設定 === */
const q = new URLSearchParams(location.search);
document.getElementById("name").textContent = q.get("name") || "西ゲート";
document.getElementById("spot").textContent = q.get("spot") || "EXPO 2025 WEST GATE";
document.getElementById("msg").textContent = q.get("msg") || "おつかれさまでした！";

/* === Canvas === */
const cv = document.getElementById("fx");
const ctx = cv.getContext("2d");
let W, H, P = [];
function resize(){ W=cv.width=innerWidth; H=cv.height=innerHeight; }
addEventListener("resize", resize); resize();

/* === パラメータ === */
const NORMAL_COUNT = 100;
const HEART_COUNT = 60;
const SPARKLE_COUNT = 40;
const MAX_PARTICLES = 600;
const FRAME_INTERVAL = 22; // 30fps固定で軽量化
const SPEED = 1.4;

/* === 生成 === */
function burst(type="normal", n=NORMAL_COUNT){
if(P.length>MAX_PARTICLES) P.splice(0, P.length - MAX_PARTICLES);

if(type==="normal"){
for(let i=0;i<n;i++) P.push(makeConfetti(false));
} else if(type==="heartSparkle"){
for(let i=0;i<HEART_COUNT;i++) P.push(makeConfetti(true));
for(let i=0;i<SPARKLE_COUNT;i++) P.push(makeSparkle()); // ←ハートと同じ動きで上がる
}
}

/* === 紙吹雪・ハート === */
function makeConfetti(isHeart){
const heart = !!isHeart;
const clr = heart
? (Math.random()<0.5?"#e6002d":"#0066cc")
: `hsl(${Math.random()*360},85%,60%)`;
const sz = heart ? (8+Math.random()*8) : (3+Math.random()*5);
const vr = heart ? ((Math.random()-0.5)*0.03) : ((Math.random()-0.5)*0.15);
return {
kind:"confetti", heart,
x:W/2, y:H/2+Math.random()*60,
vx:(Math.random()-0.5)*5,
vy:-(4+Math.random()*5),
sz, rot:Math.random()*6.28, vr, clr
};
}

/* === キラキラ（ハートと同じ挙動） === */
function makeSparkle(){
const colors=["#ffffff","#ffd700"];
const clr=colors[Math.floor(Math.random()*colors.length)];
return {
kind:"sparkle",
x:W/2, y:H/2+Math.random()*60,
vx:(Math.random()-0.5)*5,
vy:-(3+Math.random()*4),
sz:2.5+Math.random()*2.0,
clr, rot:Math.random()*6.28, vr:(Math.random()-0.5)*0.05,
life:100
};
}

/* === 形 === */
function drawHeart(p){
const s=p.sz;
ctx.beginPath();
ctx.moveTo(0,-s*0.5);
ctx.bezierCurveTo( s*0.5,-s, s,-s*0.1, 0,s*0.6);
ctx.bezierCurveTo(-s,-s*0.1,-s*0.5,-s, 0,-s*0.5);
ctx.closePath(); ctx.fill();
}

/* === ループ === */
let last=0;
function step(ts){
if(ts-last<FRAME_INTERVAL){requestAnimationFrame(step);return;}
last=ts;
ctx.clearRect(0,0,W,H);

P.forEach(p=>{
if(p.kind==="confetti" || p.kind==="sparkle"){
p.vy+=0.09 * SPEED * SPEED;
p.x+=p.vx * SPEED; 
p.y+=p.vy * SPEED; 
p.rot+=p.vr * SPEED;
ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
ctx.fillStyle=p.clr;
if(p.kind==="confetti" && p.heart) drawHeart(p);
else ctx.fillRect(-p.sz/2,-p.sz/2,p.sz,p.sz);
ctx.restore();
}
});

P=P.filter(p=>p.y<H+30);
requestAnimationFrame(step);
}
step();

/* === 抽選ボタン === */
document.getElementById("again").onclick=()=>{
const roll=Math.random();
if(roll<0.05){ burst("heartSparkle"); }
else{ burst("normal"); }
};
burst("normal",NORMAL_COUNT);
</script>

